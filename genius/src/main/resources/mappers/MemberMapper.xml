<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/schema/mybatis-3-mapper.dtd">
<mapper namespace="org.fullstack4.genius.mapper.MemberMapper">
    <sql id="whereCondition">
        <where>
            <if test="search_category == 'all'">
                member_id LIKE CONCAT('%', #{search_word}, '%') OR member_name LIKE CONCAT('%', #{search_word}, '%')
            </if>
            <if test="search_category == 'member_id'">
                member_id LIKE CONCAT('%', #{search_word}, '%')
            </if>
            <if test="search_category == 'member_name'">
                member_name LIKE CONCAT('%', #{search_word}, '%')
            </if>
            <if test="search_data1 != null and search_data1 != ''">
                AND reg_date <![CDATA[>=]]> #{search_data1}
            </if>
            <if test="search_data2 != null and search_data2 != ''">
                AND reg_date <![CDATA[<=]]> #{search_data2}
            </if>
        </where>
    </sql>
    <select id="view" resultType="org.fullstack4.genius.domain.MemberVO">
        select member_idx,member_id,member_name,pwd,birthday,phone,gender,zip_code,addr1,addr2,point,profile,reg_date,admin_YN,modify_date,leave_date,status,email,social_type
        from tbl_member
        where member_id = #{member_id}
    </select>
    <select id="login" resultType="org.fullstack4.genius.domain.MemberVO">
        SELECT member_idx,member_id,member_name,pwd,birthday,phone,gender,zip_code,addr1,addr2,point,profile,reg_date,admin_YN,modify_date,leave_date,status,email,social_type
        FROM tbl_member
        WHERE member_id = #{member_id} AND status = 'Y' AND social_type IS NULL
    </select>
    <select id="naver" resultType="org.fullstack4.genius.domain.MemberVO">
        SELECT member_idx,member_id,member_name,pwd,birthday,phone,gender,zip_code,addr1,addr2,point,profile,reg_date,admin_YN,modify_date,leave_date,status,email,social_type
        FROM tbl_member
        WHERE member_id = #{member_id} AND status = 'Y' AND social_type = 'naver'
    </select>
    <update id="pointcharge">
        update SET tbl_member point=#{point} where member_id=#{member_id}
    </update>
    <insert id="join">
        INSERT INTO tbl_member (social_type, member_id, member_name, pwd, birthday, email, phone, gender, zip_code, addr1, addr2, admin_YN, terms1, terms2, terms3, terms4)
        VALUES (#{social_type}, #{member_id}, #{member_name}, #{pwd}, #{birthday}, #{email}, #{phone}, #{gender}, #{zip_code}, #{addr1}, #{addr2}, 'N', #{terms1}, #{terms2}, #{terms3}, #{terms3})
    </insert>
    <select id="findId" resultType="string">
        SELECT member_id
        FROM tbl_member
        WHERE member_name = #{member_name} AND email = #{email}
    </select>
    <select id="findPwd" resultType="string">
        SELECT member_id
        FROM tbl_member
        WHERE member_id = #{member_id} AND member_name = #{member_name} AND email = #{email}
    </select>
    <update id="changePwd">
        UPDATE tbl_member
        SET pwd = #{pwd}
        WHERE member_id = #{member_id}
    </update>
    <update id="modifyInfo">
        UPDATE tbl_member
        SET member_name = #{member_name},
            pwd = #{pwd},
            birthday = #{birthday},
            phone = #{phone},
            gender = #{gender},
            zip_code = #{zip_code},
            addr1 = #{addr1},
            addr2 = #{addr2},
            profile = #{profile},
            modify_date = now()
        WHERE member_id = #{member_id}
    </update>
    <update id="leave">
        UPDATE tbl_member
        SET status = 'N',
            leave_date = now()
        WHERE member_id = #{member_id}
    </update>
    <select id="idCheck" resultType="int">
        SELECT COUNT(member_id) FROM tbl_member WHERE member_id = #{member_id}
    </select>
    <select id="emailCheck" resultType="int">
        SELECT COUNT(email) FROM tbl_member WHERE email = #{email}
    </select>
    <select id="list" resultType="org.fullstack4.genius.domain.MemberVO">
        SELECT member_idx,member_id,member_name,pwd,birthday,phone,gender,zip_code,addr1,addr2,point,profile,reg_date,admin_YN,modify_date,leave_date,status,email,social_type
        FROM tbl_member
        <include refid="whereCondition" />
        ORDER BY reg_date DESC
        LIMIT #{page_skip_count}, #{page_size}
    </select>
    <select id="totalCount" resultType="int">
        SELECT COUNT(*)
        FROM tbl_member
        <include refid="whereCondition" />
    </select>
    <select id="getProfile" resultType="String">
        SELECT profile
        FROM tbl_member
        WHERE member_id = #{member_id}
    </select>
</mapper>